:: Story JavaScript [script]

//'Config.history.controls = false;', removes history controls (back and forward arrows) without stoppping it from saving previous pages.
//Set to 'true' for testing reasons.

Config.history.controls = false;

//If I understand the documentation correctly, this will keep the amount of autosaves to one.
Config.saves.maxAutoSaves = 1;

//Allows saves on any passage tagged with either 'Hub' or 'Central'.
//This is to stop save-scumming on forage.
//Also only allows autosave to activate in the Sandbox Central passage.
Config.saves.isAllowed = function (saveType) {
	if (saveType === Save.Type.Auto) {
		return tags().includes("Central");
	}
	return tags().includes("Hub", "Central");
};

//Lets you name your saves...!

Config.saves.onSave = function (save, details) {
	if (details.type === "slot") {
		var title = prompt("Enter Save Slot Title:", save.title);
		if (title !== null) {
			save.title = title;
		}
	}
};

// On trying to go to a forage passage... (looking for any mats or eggs)
// Config.navigation.override = function (dest) {
//	if (tags(dest).includes("forage")) {
//
//		if (random(1, 100) <= 12) {
//			
//			State.variables.continue = dest;
//			
//			dest = Story.lookup("tags", "forage_event").random().title;
//			
//	} else {
//		
//		delete State.variables.continue;
//	}
//	
//	return dest;
//};

/*! <<numberpool>> macro set for SugarCube v2 */
!function(){"use strict";if("undefined"==typeof version||void 0===version.name||"SugarCube"!==version.name||void 0===version.major||version.major<2||void 0===version.minor||version.minor<37)throw new Error("<<numberpool>> macro set requires SugarCube 2.37.0 or greater, aborting load");Macro.add("numberinput",{handler:function(){function validateAndApply(e,r){var a=Math.trunc(State.getVar(t)),u=Math.trunc(e.value),h=null;if(Number.isNaN(u)||!Number.isFinite(u))return e.value=a,!1;if(null!=r&&(u+=r),u<i?u=i:u>n&&(u=n),null!==o){var l=o.get(),m=(u-a)*s;m<0?h=l-m:m>0&&l>=s?(l<m&&(u=a+Math.trunc(l/s),m=l-l%s),h=l-m):u=a}return State.setVar(t,u),e.value=u,null!==h&&o.set(h),!0}if(this.args.length<4){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.args.length<3&&e.push("min value"),this.args.length<4&&e.push("max value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=createSlug(t),a=Number(this.args[1]),i=Number(this.args[2]),n=Number(this.args[3]),s=1,u=!1;if(this.args.length>5?(s=Number(this.args[4]),u="autofocus"===this.args[5]):this.args.length>4&&("autofocus"===this.args[4]?u=!0:s=Number(this.args[4])),Number.isNaN(a)||!Number.isFinite(a)||Math.trunc(a)!==a)return this.error("default value ("+this.args[1]+") is not a whole number");if(Number.isNaN(i)||!Number.isFinite(i)||Math.trunc(i)!==i)return this.error("min value ("+this.args[2]+") is not a whole number");if(Number.isNaN(n)||!Number.isFinite(n)||Math.trunc(n)!==n)return this.error("max value ("+this.args[3]+") is not a whole number");if(Number.isNaN(s)||!Number.isFinite(s)||Math.trunc(s)!==s||s<=0)return this.error("pool cost ("+this.args[4]+") is not a whole number greater than zero");if(a<i)return this.error("default value ("+this.args[1]+") is less than min value ("+this.args[2]+")");if(a>n)return this.error("default value ("+this.args[1]+") is greater than max value ("+this.args[3]+")");var o=(()=>{var e=this.contextFind((e=>"numberpool"===e.name));return null!=e&&e.hasOwnProperty("pool")?e.pool:null})();Config.debug&&this.debugView.modes({block:!0});var h=jQuery(document.createElement("div")),l=jQuery(document.createElement("input"));h.attr("id",this.name+"-body-"+r).addClass("macro-"+this.name).appendTo(this.output),jQuery(document.createElement("button")).attr({id:this.name+"-minus-"+r}).text("").ariaClick(this.shadowHandler((function(){return validateAndApply(l.get(0),-1)}))).appendTo(h),l.attr({id:this.name+"-input-"+r,name:this.name+"-input-"+r,type:"text",pattern:"\\d+",tabindex:0}).on("change",this.shadowHandler((function(){validateAndApply(this)}))).on("keypress",(function(e){13===e.which&&(e.preventDefault(),l.trigger("change"))})).appendTo(h),jQuery(document.createElement("button")).attr({id:this.name+"-plus-"+r}).text("").ariaClick(this.shadowHandler((function(){return validateAndApply(l.get(0),1)}))).appendTo(h),l.val(a),validateAndApply(l.get(0)),u&&(l.attr("autofocus","autofocus"),jQuery(document).one(":passagedisplay",(function(){return setTimeout((function(){return l.focus()}),Engine.DOM_DELAY)})))}}),Macro.add("numberpool",{tags:["onchange"],handler:function(){if(0===this.args.length)return this.error("no variable name specified");if(this.payload.length>2)return this.error("multiple <<onchange>> sections specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var e=this.args[0].trim();if("$"!==e[0]&&"_"!==e[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=State.getVar(e);if("number"!=typeof t||Number.isNaN(t)||!Number.isFinite(t))return this.error("pool value is not a number");var r,a=createSlug(e);Object.hasOwn(TempState,this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(a)||(TempState[this.name][a]=0),Object.defineProperty(this,"pool",{value:Object.defineProperties({},{get:{value:function(){return State.getVar(e)}},set:{value:(r=this.payload.length>1?this.payload[1].contents.trim():"",function(t){t!==State.getVar(e)&&(State.setVar(e,t),r&&new Wikifier(null,r))})}})}),jQuery(document.createElement("div")).attr("id",this.name+"-"+a+"-"+TempState[this.name][a]++).addClass("macro-"+this.name).wiki(this.payload[0].contents.replace(/^\n/,"")).appendTo(this.output)}}),Macro.add("numberslider",{handler:function(){function stepValidate(e){if(l>0){var t=Number(i+"e"+l),r=Number(s+"e"+l),a=Number(e+"e"+l)-t;return Number(a-a%r+t+"e-"+l)}var n=e-i;return n-n%s+i}function validateAndApply(e){var r=State.getVar(t),a=Number(e.value),s=null;if(Number.isNaN(a)||!Number.isFinite(a))return e.value=r,!1;if((a=stepValidate(a))<i?a=i:a>n&&(a=n),null!==m)if(l>0){var u=Number(m.get()+"e"+l),o=Number(r+"e"+l),h=Number(a+"e"+l),g=h-o;u<g&&(g=(h-=g-u)-o,a=Number(h+"e-"+l)),s=Number(u-g+"e-"+l)}else{var d=m.get(),p=a-r;d<p&&(p=(a-=p-d)-r),s=d-p}return State.setVar(t,a),e.value=a,null!==s&&m.set(s),!0}if(this.args.length<5){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.args.length<3&&e.push("min value"),this.args.length<4&&e.push("max value"),this.args.length<5&&e.push("step value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=createSlug(t),a=Number(this.args[1]),i=Number(this.args[2]),n=Number(this.args[3]),s=Number(this.args[4]),u=this.args.length>5&&"autofocus"===this.args[5];if(Number.isNaN(a)||!Number.isFinite(a))return this.error("default value ("+this.args[1]+") is not a number");if(Number.isNaN(i)||!Number.isFinite(i))return this.error("min value ("+this.args[2]+") is not a number");if(Number.isNaN(n)||!Number.isFinite(n))return this.error("max value ("+this.args[3]+") is not a number");if(Number.isNaN(s)||!Number.isFinite(s)||s<=0)return this.error("step value ("+this.args[4]+") is not a number greater than zero");if(a<i)return this.error("default value ("+this.args[1]+") is less than min value ("+this.args[2]+")");if(a>n)return this.error("default value ("+this.args[1]+") is greater than max value ("+this.args[3]+")");var o,h,l=(o=String(s),-1===(h=o.lastIndexOf("."))?0:o.length-h-1);if(stepValidate(n)!==n)return this.error("max value ("+this.args[3]+") is not a multiple of the step value ("+this.args[4]+") plus the min value ("+this.args[2]+")");var m=(()=>{var e=this.contextFind((e=>"numberpool"===e.name));return null!=e&&e.hasOwnProperty("pool")?e.pool:null})();Config.debug&&this.debugView.modes({block:!0});var g=jQuery(document.createElement("div")),d=jQuery(document.createElement("input")),p=void 0,v=void 0;g.attr("id",this.name+"-body-"+r).addClass("macro-"+this.name).appendTo(this.output),d.attr({id:this.name+"-input-"+r,name:this.name+"-input-"+r,type:"range",min:i,max:n,step:s,tabindex:0}).on("change input."+createSlug(this.name),this.shadowHandler((function(){validateAndApply(this),"function"==typeof v&&v()}))).on("keypress",(function(e){13===e.which&&(e.preventDefault(),d.trigger("change"))})).appendTo(g),!Browser.isIE||Browser.ieVersion>9?(p=jQuery(document.createElement("span")).attr("id",this.name+"-value-"+r).appendTo(g),v=function(){p.text(Number(d.val()).toFixed(l))}):d.off("input."+createSlug(this.name)),d.val(a),validateAndApply(d.get(0)),"function"==typeof v&&v(),u&&(d.attr("autofocus","autofocus"),jQuery(document).one(":passagedisplay",(function(){return setTimeout((function(){return d.focus()}),Engine.DOM_DELAY)})))}})}();

;(function () {
	var favicon  = document.createElement("link");
	favicon.rel  = "icon";
	favicon.type = "png";
	favicon.href = "https://github.com/DrekiWork/DREKI/blob/main/Media/Dreki%20symbol%20(no%20BG,%20no%20jewel).png?raw=true";
	document.head.appendChild(favicon);
}());
